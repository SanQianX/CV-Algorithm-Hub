# ============================================
# Prometheus Configuration
# ============================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'cvhub-production'
    env: 'production'

alerting:
  alertmanagers:
    - static_configs:
        - targets: []

rule_files:
  - '/etc/prometheus/rules/*.yml'

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # API Gateway metrics
  - job_name: 'api-gateway'
    metrics_path: /metrics
    static_configs:
      - targets: ['api-gateway:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+):\\d+'

  # Algorithm Manager metrics
  - job_name: 'algorithm-manager'
    metrics_path: /metrics
    static_configs:
      - targets: ['algorithm-manager:8081']

  # Task Orchestrator metrics
  - job_name: 'task-orchestrator'
    metrics_path: /metrics
    static_configs:
      - targets: ['task-orchestrator:8082']

  # Algorithm Engine metrics
  - job_name: 'algorithm-engine'
    metrics_path: /metrics
    static_configs:
      - targets: ['algorithm-engine:8083']

  # Data Manager metrics
  - job_name: 'data-manager'
    metrics_path: /metrics
    static_configs:
      - targets: ['data-manager:8084']

  # Monitoring metrics
  - job_name: 'monitoring'
    metrics_path: /metrics
    static_configs:
      - targets: ['monitoring:8085']

  # Docker metrics
  - job_name: 'docker'
    metrics_path: /metrics
    static_configs:
      - targets: ['cadvisor:8080']

  # Node exporter
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']

# GPU metrics (if available)
  - job_name: 'nvidia-gpu'
    static_configs:
      - targets: ['nvidia-dcgm-exporter:9400']
