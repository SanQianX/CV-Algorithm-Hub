import{d as J,o as O,c as i,p as e,u as q,E as A,b as G,D as w,z as n,A as c,I as K,J as Q,y as V,B as f,C as h,x as W,r as p,F as S,e as d}from"./vendor-EuZm8Jb1.js";import{M as X}from"./ModeToggle-bHcRDFnx.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"user-manager-page"},ee={class:"page-header"},se={class:"header-left"},ae={class:"header-right"},te={class:"page-main"},oe={class:"container"},le={class:"toolbar"},re={class:"toolbar-left"},ne={class:"user-count"},ie={class:"toolbar-right"},de=["disabled"],ue={class:"table-container"},me={class:"data-table"},ce={key:0},pe={key:1},ve={class:"id-cell"},we={class:"username-cell"},ge={class:"email-cell"},fe={class:"date-cell"},he={class:"date-cell"},be={class:"action-cell"},ke=["onClick"],ye=["onClick"],_e={key:1,class:"pagination"},xe=["disabled"],Ce={class:"page-info"},Me=["disabled"],Pe={class:"modal"},$e={class:"modal-body"},Ve={key:0,class:"error-text"},Ue={key:0,class:"error-text"},je={key:0,class:"error-text"},ze={key:0,class:"error-text"},Ae={class:"modal-actions"},Se=["disabled"],Be={class:"modal"},Ee={class:"modal-body"},Le={key:0,class:"error-text"},Te={key:0,class:"error-text"},De={key:0,class:"error-text"},Ne={class:"modal-actions"},Fe=["disabled"],y="",He=J({__name:"UserManagerView",setup(Ie){const L=W(),_=p(!1),x=p(!1),v=p(!1),C=p(""),B=p("success"),U=p(!1),j=p(!1),z=p([]),M=p(null),u=p({page:1,pageSize:20,total:0,totalPages:0}),r=S({username:"",email:"",password:"",confirmPassword:""}),l=S({username:"",email:"",password:""}),t=S({username:"",email:"",password:"",confirmPassword:""}),m=(o,s)=>{C.value=o,B.value=s,setTimeout(()=>{C.value=""},3e3)},b=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}),E=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),g=async(o=1)=>{_.value=!0;try{const s=await fetch(`${y}/api/v1/db-manager/users?page=${o}&page_size=${u.value.pageSize}`,{headers:b()});if(s.ok){const a=await s.json();z.value=a.items||[],u.value={page:a.page,pageSize:a.page_size,total:a.total,totalPages:a.total_pages}}else{const a=await s.json();m(a.detail||"加载用户列表失败","error")}}catch(s){console.error("加载用户列表失败:",s),m("加载用户列表失败","error")}finally{_.value=!1}},T=async()=>{x.value=!0,await g(u.value.page),x.value=!1},D=()=>{t.username="",t.email="",t.password="",t.confirmPassword="";let o=!0;!r.username||r.username.length<3?(t.username="用户名长度至少为3个字符",o=!1):r.username.length>20&&(t.username="用户名长度不能超过20个字符",o=!1);const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return(!r.email||!s.test(r.email))&&(t.email="请输入有效的邮箱地址",o=!1),(!r.password||r.password.length<6)&&(t.password="密码长度至少为6个字符",o=!1),r.password!==r.confirmPassword&&(t.confirmPassword="两次输入的密码不一致",o=!1),o},N=()=>{t.username="",t.email="",t.password="";let o=!0;return l.username&&(l.username.length<3?(t.username="用户名长度至少为3个字符",o=!1):l.username.length>20&&(t.username="用户名长度不能超过20个字符",o=!1)),l.email&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||(t.email="请输入有效的邮箱地址",o=!1)),l.password&&l.password.length<6&&(t.password="密码长度至少为6个字符",o=!1),o},F=async()=>{if(D()){v.value=!0;try{const o=await fetch(`${y}/api/v1/db-manager/users`,{method:"POST",headers:b(),body:JSON.stringify({username:r.username,email:r.email,password:r.password})});if(o.ok)m("添加用户成功","success"),P(),await g(u.value.page);else{const s=await o.json();m(s.detail||"添加用户失败","error")}}catch(o){console.error("添加用户失败:",o),m("添加用户失败","error")}finally{v.value=!1}}},H=async(o,s)=>{if(confirm(`确定要删除用户 "${s}" 吗？此操作不可恢复！`))try{const a=await fetch(`${y}/api/v1/db-manager/users/${o}`,{method:"DELETE",headers:b()});if(a.ok){const k=await a.json();m(k.message||"删除用户成功","success"),await g(u.value.page)}else{const k=await a.json();m(k.detail||"删除用户失败","error")}}catch(a){console.error("删除用户失败:",a),m("删除用户失败","error")}},I=async o=>{try{const s=await fetch(`${y}/api/v1/db-manager/users/${o}`,{headers:b()});if(s.ok){const a=await s.json();M.value=a,l.username=a.username,l.email=a.email,l.password="",j.value=!0}else m("获取用户信息失败","error")}catch(s){console.error("获取用户信息失败:",s),m("获取用户信息失败","error")}},R=async()=>{if(M.value&&N()){v.value=!0;try{const o={};l.username&&(o.username=l.username),l.email&&(o.email=l.email),l.password&&(o.password=l.password);const s=await fetch(`${y}/api/v1/db-manager/users/${M.value.id}`,{method:"PUT",headers:b(),body:JSON.stringify(o)});if(s.ok)m("更新用户成功","success"),$(),await g(u.value.page);else{const a=await s.json();m(a.detail||"更新用户失败","error")}}catch(o){console.error("更新用户失败:",o),m("更新用户失败","error")}finally{v.value=!1}}},P=()=>{U.value=!1,r.username="",r.email="",r.password="",r.confirmPassword="",t.username="",t.email="",t.password="",t.confirmPassword=""},$=()=>{j.value=!1,M.value=null,l.username="",l.email="",l.password="",t.username="",t.email="",t.password=""};return O(()=>{g()}),(o,s)=>(d(),i("div",Z,[e("header",ee,[e("div",se,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=a=>q(L).push("/dashboard"))},[...s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),A(" 返回 ",-1)])]),s[12]||(s[12]=e("h1",{class:"logo"},"用户信息管理",-1))]),e("div",ae,[G(X)])]),e("main",te,[e("div",oe,[C.value?(d(),i("div",{key:0,class:w(["message",B.value])},n(C.value),3)):c("",!0),e("div",le,[e("div",re,[s[13]||(s[13]=e("h2",{class:"page-title"},"用户列表",-1)),e("span",ne,"共 "+n(u.value.total)+" 个用户",1)]),e("div",ie,[e("button",{class:"action-btn add",onClick:s[1]||(s[1]=a=>U.value=!0)},[...s[14]||(s[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})],-1),A(" 添加用户 ",-1)])]),e("button",{class:"action-btn refresh",onClick:T,disabled:x.value},[s[15]||(s[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})],-1)),A(" "+n(x.value?"刷新中...":"刷新"),1)],8,de)])]),e("div",ue,[e("table",me,[s[20]||(s[20]=e("thead",null,[e("tr",null,[e("th",null,"用户ID"),e("th",null,"用户名"),e("th",null,"邮箱"),e("th",null,"注册时间"),e("th",null,"最后更新"),e("th",null,"操作")])],-1)),e("tbody",null,[!_.value&&z.value.length===0?(d(),i("tr",ce,[...s[16]||(s[16]=[e("td",{colspan:"6",class:"empty-state"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})]),e("p",null,"暂无用户数据")],-1)])])):_.value?(d(),i("tr",pe,[...s[17]||(s[17]=[e("td",{colspan:"6",class:"loading-state"},[e("div",{class:"spinner"}),e("p",null,"加载中...")],-1)])])):c("",!0),(d(!0),i(K,null,Q(z.value,a=>(d(),i("tr",{key:a.id},[e("td",ve,n(a.id),1),e("td",we,n(a.username),1),e("td",ge,n(a.email),1),e("td",fe,n(E(a.created_at)),1),e("td",he,n(E(a.updated_at)),1),e("td",be,[e("button",{class:"icon-btn edit",onClick:k=>I(a.id),title:"编辑用户"},[...s[18]||(s[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})],-1)])],8,ke),e("button",{class:"icon-btn delete",onClick:k=>H(a.id,a.username),title:"删除用户"},[...s[19]||(s[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)])],8,ye)])]))),128))])])]),u.value.totalPages>1?(d(),i("div",_e,[e("button",{class:"page-btn",disabled:u.value.page===1,onClick:s[2]||(s[2]=a=>g(u.value.page-1))}," 上一页 ",8,xe),e("span",Ce," 第 "+n(u.value.page)+" / "+n(u.value.totalPages)+" 页 ",1),e("button",{class:"page-btn",disabled:u.value.page===u.value.totalPages,onClick:s[3]||(s[3]=a=>g(u.value.page+1))}," 下一页 ",8,Me)])):c("",!0)])]),U.value?(d(),i("div",{key:0,class:"modal-overlay",onClick:V(P,["self"])},[e("div",Pe,[e("div",{class:"modal-header"},[s[21]||(s[21]=e("h3",null,"添加用户",-1)),e("button",{class:"close-btn",onClick:P},"×")]),e("div",$e,[e("form",{onSubmit:V(F,["prevent"])},[e("div",{class:w(["form-group",{"has-error":t.username}])},[s[22]||(s[22]=e("label",null,"用户名",-1)),f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>r.username=a),type:"text",placeholder:"请输入用户名（3-20个字符）",maxlength:"20"},null,512),[[h,r.username]]),t.username?(d(),i("span",Ve,n(t.username),1)):c("",!0)],2),e("div",{class:w(["form-group",{"has-error":t.email}])},[s[23]||(s[23]=e("label",null,"邮箱",-1)),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>r.email=a),type:"email",placeholder:"请输入邮箱地址"},null,512),[[h,r.email]]),t.email?(d(),i("span",Ue,n(t.email),1)):c("",!0)],2),e("div",{class:w(["form-group",{"has-error":t.password}])},[s[24]||(s[24]=e("label",null,"密码",-1)),f(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>r.password=a),type:"password",placeholder:"请输入密码（至少6个字符）"},null,512),[[h,r.password]]),t.password?(d(),i("span",je,n(t.password),1)):c("",!0)],2),e("div",{class:w(["form-group",{"has-error":t.confirmPassword}])},[s[25]||(s[25]=e("label",null,"确认密码",-1)),f(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>r.confirmPassword=a),type:"password",placeholder:"请再次输入密码"},null,512),[[h,r.confirmPassword]]),t.confirmPassword?(d(),i("span",ze,n(t.confirmPassword),1)):c("",!0)],2),e("div",Ae,[e("button",{type:"button",class:"cancel-btn",onClick:P},"取消"),e("button",{type:"submit",class:"submit-btn",disabled:v.value},n(v.value?"提交中...":"添加"),9,Se)])],32)])])])):c("",!0),j.value?(d(),i("div",{key:1,class:"modal-overlay",onClick:V($,["self"])},[e("div",Be,[e("div",{class:"modal-header"},[s[26]||(s[26]=e("h3",null,"编辑用户",-1)),e("button",{class:"close-btn",onClick:$},"×")]),e("div",Ee,[e("form",{onSubmit:V(R,["prevent"])},[e("div",{class:w(["form-group",{"has-error":t.username}])},[s[27]||(s[27]=e("label",null,"用户名",-1)),f(e("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>l.username=a),type:"text",placeholder:"留空表示不修改",maxlength:"20"},null,512),[[h,l.username]]),t.username?(d(),i("span",Le,n(t.username),1)):c("",!0)],2),e("div",{class:w(["form-group",{"has-error":t.email}])},[s[28]||(s[28]=e("label",null,"邮箱",-1)),f(e("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>l.email=a),type:"email",placeholder:"留空表示不修改"},null,512),[[h,l.email]]),t.email?(d(),i("span",Te,n(t.email),1)):c("",!0)],2),e("div",{class:w(["form-group",{"has-error":t.password}])},[s[29]||(s[29]=e("label",null,"新密码",-1)),f(e("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>l.password=a),type:"password",placeholder:"留空表示不修改密码"},null,512),[[h,l.password]]),t.password?(d(),i("span",De,n(t.password),1)):c("",!0)],2),e("div",Ne,[e("button",{type:"button",class:"cancel-btn",onClick:$},"取消"),e("button",{type:"submit",class:"submit-btn",disabled:v.value},n(v.value?"提交中...":"保存"),9,Fe)])],32)])])])):c("",!0)]))}}),qe=Y(He,[["__scopeId","data-v-ad226d5e"]]);export{qe as default};
